<div class="title">
    <h1>Transactions 
    <!-- <button hx-post="/transactions/duplicate/remove" hx-trigger="click">Remove Duplicates</button> -->
    </h1>
    <div class="custom-month-input">
        <button hx-trigger="click" hx-get="/transactions/download" hx-swap="innerHTML"  hx-target="#content">
            Fetch New Transactions
            <img src="/static/icons/loader.svg" alt="loader" class="htmx-loader">
        </button>
        <div>
            <input type="month" name="date" id="date" hx-get="/templates/transactions" hx-trigger="change" hx-target="#content" hx-swap="innerHTML">
            <div class="icon">&#x1F4C5;</div>
            <script>
                var selectedDate = QUERY_PARAMS.get('date') ? new Date(QUERY_PARAMS.get('date')).toISOString().slice(0, 7) : new Date().toISOString().slice(0, 7);
                document.querySelector('#date').value = selectedDate;
            </script>
        </div>
    </div>
</div>
<div class="tableContainer">
    <div class="border">
        <section class="scroll">
            <table>
                <thead>
                    <tr>
                        <th class="dn-mobile">Date</th>
                        <th class="dn-mobile">Bank</th>
                        <th class="left">Amount</th>
                        <th class="right">Transaction Memo</th>
                        <th class="dn-mobile">Budget Item</th>
                        <th class="dn-mobile">Transaction Type</th>
                        <th class="dn-mobile">Auto Generated</th>
                    </tr>
                </thead>
                <tbody>
                    {{ range .TransactionsData }}
                        {{if and .Transaction}}
                        <tr>
                            {{ $currentTransaction := .Transaction }} <!-- Keep a reference to the current Transaction -->
                            <td class="dn-mobile">{{ formatDate .Transaction.TransactionDate }}</td>
                            <td class="dn-mobile">{{ .Transaction.BankName }}</td>
                            <td class="left">
                                R {{ formatPrice .Transaction.TransactionAmount }}
                                <span class="block dn-desktop muted">{{ .Transaction.BankName }}</span>
                            </td>
                            <td class="right nowrap">
                                {{if isEmpty .Transaction.TransactionName}}
                                    <span class="tn-memo">{{.Transaction.TransactionMemo}}</span>
                                {{else}}
                                    <span class="tn-memo">{{.Transaction.TransactionName}}</span>
                                {{end}}
                                <span class="block dn-desktop muted">{{ formatDate .Transaction.TransactionDate }}</span>
                            </td>
                            <td class="dn-mobile">
                                <select name="budgetItemID" id="budgetItemSelect"
                                    hx-post="/transactions/{{ .Transaction.ID }}/budgetitems/add" hx-trigger="change">
                                    <option value="" disabled selected>Select</option>
                                    {{ range .BudgetItems }}
                                        {{ if isNil $currentTransaction.BudgetID }}
                                        <option value="{{ .ID }}">{{ .Name }}</option>
                                        {{ else }}
                                        <option value="{{ .ID }}" {{ if eq .ID (dereferencePntr $currentTransaction.BudgetID)}}selected{{ end }}>{{ .Name }}</option>
                                        {{ end }}
                                    {{ end }}
                                </select>
                            </td>
                            <td class="dn-mobile">
                                <select name="transactionTypeID" id="transactionTypeSelect"
                                    hx-post="/transactions/{{ .Transaction.ID }}/transactionstypes/add" hx-trigger="change">
                                    <option value="" disabled selected>Select</option>
                                    {{ range .TransactionTypes }}
                                    <option value="{{ .ID }}" {{ if eq .ID (dereferencePntr $currentTransaction.TransactionTypeID) }}selected{{
                                        end }}>{{ .Title }}</option>
                                    {{ end }}
                                </select>
                            </td>
                            <td class="dn-mobile">
                                <input type="checkbox" name="autoGenerated" id="autoGenerated"
                                    hx-post="/transactions/{{ .Transaction.ID }}/autogenerated" hx-trigger="change"
                                    {{ if .Transaction.AutoCategorized }}checked{{ end }}>
                            </td>
                        </tr>
                        {{ end }}
                    {{ end }}
                </tbody>
            </table>
        </section>
    </div>

    <!-- <h2>Add Transaction</h2>
    
    <form>
        <label for="date">Date:</label>
        <input type="date" id="date" name="date">
    
        <label for="amount">Amount:</label>
        <input type="number" id="amount" name="amount">
    
        <label for="type">Type:</label>
        <select id="type" name="type">
            <option value="income">Income</option>
            <option value="expense">Expense</option>
        </select>
    
        <button type="submit">Add</button>
    </form> -->
</div>